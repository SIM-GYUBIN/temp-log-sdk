"use strict";var Cholog=(()=>{var y=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var L=(c,e)=>{for(var r in e)y(c,r,{get:e[r],enumerable:!0})},S=(c,e,r,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of I(e))!C.call(c,o)&&o!==r&&y(c,o,{get:()=>e[o],enumerable:!(t=T(e,o))||t.enumerable});return c};var E=c=>S(y({},"__esModule",{value:!0}),c);var k={};L(k,{Cholog:()=>b,default:()=>R});var s=class{static{this.currentTraceId=null}static{this.currentSpanId=null}static startNewTrace(){return this.currentTraceId=this.generateId("trace"),this.currentSpanId=null,this.currentTraceId}static getCurrentTraceId(){return this.currentTraceId}static setCurrentTraceId(e){this.currentTraceId=e}static generateId(e){return crypto&&crypto.randomUUID?crypto.randomUUID():`<span class="math-inline">{prefix}-</span>{Date.now()}-${Math.random().toString(36).substring(2,9)}`}};var i=class{static{this.appKey=""}static{this.apiEndpoint="http://localhost:8080/logs"}static{this.originalConsole=null}static{this.logQueue=[]}static{this.batchInterval=1e3}static{this.batchTimeoutId=null}static{this.maxQueueSize=100*1024}static{this.currentQueueSize=0}static init(e){if(this.originalConsole!==null){console.warn("Logger already initialized.");return}this.appKey=e.appKey,e.batchInterval&&(this.batchInterval=e.batchInterval),e.maxQueueSize&&(this.maxQueueSize=e.maxQueueSize),this.overrideConsoleMethods()}static getApiEndpoint(){return this.apiEndpoint}static overrideConsoleMethods(){this.originalConsole={log:console.log.bind(console),info:console.info.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),debug:console.debug.bind(console),trace:console.trace.bind(console)},console.log=(...e)=>this.queueAndPrint("info",e),console.info=(...e)=>this.queueAndPrint("info",e),console.warn=(...e)=>this.queueAndPrint("warn",e),console.error=(...e)=>this.queueAndPrint("error",e),console.debug=(...e)=>this.queueAndPrint("debug",e),console.trace=(...e)=>this.queueAndPrint("trace",e)}static queueAndPrint(e,r){this.originalConsole&&this.originalConsole[e](...r),this.queueLog(e,r)}static queueLog(e,r){let t=r.map(n=>typeof n=="object"?JSON.stringify(n):String(n)).join(" "),o={level:e,message:t,timestamp:new Date().toISOString(),traceId:s.getCurrentTraceId()},u=new Blob([JSON.stringify(o)]).size;this.logQueue.push(o),this.currentQueueSize+=u,this.currentQueueSize>this.maxQueueSize?this.sendBatch():this.scheduleBatch()}static scheduleBatch(){this.batchTimeoutId===null&&(this.batchTimeoutId=window.setTimeout(async()=>{await this.sendBatch(),this.batchTimeoutId=null,this.logQueue.length>0&&this.scheduleBatch()},this.batchInterval))}static async sendBatch(){if(this.logQueue.length===0)return;let e=[...this.logQueue];this.logQueue=[],this.currentQueueSize=0;try{let r=await fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json","App-Key":this.appKey},body:JSON.stringify(e)});if(!r.ok)throw new Error(`Log send failed: ${r.status}`)}catch(r){this.originalConsole?this.originalConsole.error("Logger sendBatch error:",r):console.error("Logger sendBatch error (original console unavailable):",r)}}static info(...e){if(!this.appKey){console.warn("Cholog SDK is not initialized. Call ChologSDK.init first.");return}this.queueLog("info",e)}static warn(...e){if(!this.appKey){console.warn("Cholog SDK is not initialized. Call ChologSDK.init first.");return}this.queueLog("warn",e)}static error(...e){if(!this.appKey){console.warn("Cholog SDK is not initialized. Call ChologSDK.init first.");return}this.queueLog("error",e)}static debug(...e){if(!this.appKey){console.warn("Cholog SDK is not initialized. Call ChologSDK.init first.");return}this.queueLog("debug",e)}static trace(...e){if(!this.appKey){console.warn("Cholog SDK is not initialized. Call ChologSDK.init first.");return}this.queueLog("trace",e)}};var m=class c{static{this.isInitialized=!1}static{this.originalFetch=null}static{this.originalXhrSend=null}static patchFetch(){this.originalFetch=window.fetch;let e=this;window.fetch=async(r,t)=>{let o=typeof r=="string"?r:r.toString(),u=i.getApiEndpoint();if(u&&o.startsWith(u))return c.originalFetch.call(window,r,t);let n=s.getCurrentTraceId(),p=!1;n||(n=s.startNewTrace(),p=!0);let g={...t||{}},a=g.headers,d;a instanceof Headers?d=new Headers(a):Array.isArray(a)?d=new Headers(a):typeof a=="object"&&a!==null?d=new Headers(a):d=new Headers,d.set("X-Request-ID",n),g.headers=d;let h=Date.now();i.info(`API Request START: ${typeof r=="string"?r:r.toString()}`,{traceId:n,method:g.method||"GET"});try{let l=await e.originalFetch.call(window,r,g),f=Date.now()-h;return i.info(`API Request END: ${l.status} ${l.url}`,{traceId:n,status:l.status,durationMs:f}),l}catch(l){let f=Date.now()-h;throw i.error(`API Request FAILED: ${typeof r=="string"?r:r.toString()}`,{traceId:n,error:l,durationMs:f}),l}finally{}}}static patchXMLHttpRequest(){this.originalXhrSend=XMLHttpRequest.prototype.send;let e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(r,t,o,u,n){this._chologMethod=r,this._chologUrl=typeof t=="string"?t:t.toString(),e.apply(this,arguments)},XMLHttpRequest.prototype.send=function(r){let t=this,o=t._chologUrl,u=i.getApiEndpoint();if(u&&o&&o.startsWith(u))return c.originalXhrSend.apply(this,arguments);let n=s.getCurrentTraceId(),p=!1;n||(n=s.startNewTrace(),p=!0),t._chologTraceId=n;try{this.setRequestHeader("X-Request-ID",n)}catch(d){i.error("Cholog SDK: Failed to set X-Request-ID header for XHR.",{traceId:n,error:d,url:t._chologUrl})}let g=()=>{t._chologStartTime=Date.now(),i.info(`API Request START: ${t._chologMethod||"UnknownMethod"} ${t._chologUrl||"UnknownURL"}`,{traceId:t._chologTraceId,method:t._chologMethod,type:"XHR"}),t.removeEventListener("loadstart",g)},a=()=>{let d=t._chologStartTime?Date.now()-t._chologStartTime:void 0;t.readyState===4&&(t.status>=200&&t.status<400?i.info(`API Request END: ${t.status} ${t.responseURL||t._chologUrl||"UnknownURL"}`,{traceId:t._chologTraceId,status:t.status,durationMs:d,type:"XHR"}):t.status>=400&&i.error(`API Request FAILED: ${t.status} ${t.responseURL||t._chologUrl||"UnknownURL"}`,{traceId:t._chologTraceId,status:t.status,statusText:t.statusText,durationMs:d,type:"XHR"})),t.removeEventListener("load",a),t.removeEventListener("error",a),t.removeEventListener("abort",a),t.removeEventListener("timeout",a)};if(t.addEventListener("loadstart",g),t.addEventListener("load",a),t.addEventListener("error",a),t.addEventListener("abort",a),t.addEventListener("timeout",a),!c.originalXhrSend){console.error("Original XHR send function not found!"),i.error("Original XHR send function not found!",{traceId:n});return}return c.originalXhrSend.apply(this,arguments)}}static init(){if(this.isInitialized){console.warn("NetworkInterceptor is already initialized.");return}if(typeof window>"u"||typeof XMLHttpRequest>"u"){console.warn("NetworkInterceptor: Not running in a browser environment? Skipping patch.");return}try{this.patchFetch(),this.patchXMLHttpRequest(),this.isInitialized=!0,console.log("Cholog NetworkInterceptor initialized successfully.")}catch(e){console.error("Cholog SDK: Failed to initialize NetworkInterceptor.",e)}}};var w=class{static{this.isInitialized=!1}static{this.handleGlobalError=(e,r,t,o,u)=>{let n,p=r,g=t,a=o,d,h,l=u;if(e instanceof ErrorEvent&&e.error?(l=e.error,n=e.message||l?.message||"Error message not available",p=e.filename,g=e.lineno,a=e.colno,h=l?.name,d=l?.stack):typeof e=="string"?(n=e,l&&(h=l.name,d=l.stack)):l?(n=l.message,h=l.name,d=l.stack):(n="A non-error event was captured by the error handler.",h="UnknownError"),d?.includes("cholog")||n?.includes("Cholog SDK")){console.warn("Cholog SDK: Suppressed potential recursive error log.",n);return}let f={errorType:h||"Error",stack:d,sourceFile:p,lineno:g,colno:a,userAgent:navigator.userAgent,pageUrl:window.location.href};i.error(n||"Uncaught JavaScript Error",f)}}static{this.handleUnhandledRejection=e=>{let r=e.reason,t,o,u;if(r instanceof Error)t=r.message,o=r.stack,u=r.name;else{try{t=`Unhandled promise rejection: ${JSON.stringify(r)}`}catch{t="Unhandled promise rejection: [Non-serializable reason]"}u=typeof r}if(o?.includes("cholog")||t?.includes("Cholog SDK")){console.warn("Cholog SDK: Suppressed potential recursive error log.",t);return}let n={errorType:u||"UnhandledRejection",stack:o,sourceFile:o?void 0:window.location.href,userAgent:navigator.userAgent,pageUrl:window.location.href,reason:r instanceof Error?void 0:String(r)};i.error(t||"Unhandled Promise Rejection",n)}}static init(){if(!(this.isInitialized||typeof window>"u"))try{window.onerror=this.handleGlobalError,window.addEventListener("unhandledrejection",this.handleUnhandledRejection),this.isInitialized=!0,console.log("Cholog ErrorCatcher initialized successfully.")}catch(e){console.error("Cholog SDK: Failed to initialize ErrorCatcher.",e)}}};var v=class{static{this.config={newTraceOnClick:!0,clickTargetSelector:'button, a, [role="button"]'}}static init(e){e?.newTraceOnClick!==void 0&&(this.config.newTraceOnClick=e.newTraceOnClick),e?.clickTargetSelector&&(this.config.clickTargetSelector=e.clickTargetSelector),this.startNewTraceForNavigation(window.location.href),window.addEventListener("hashchange",()=>this.startNewTraceForNavigation(window.location.href)),document.addEventListener("click",r=>{if(!this.config.newTraceOnClick){s.getCurrentTraceId()||s.startNewTrace(),this.logGeneralClick(r.target);return}let t=r.target;t.closest(this.config.clickTargetSelector)?(s.startNewTrace(),i.info("Action started: Click on interactive element",{traceId:s.getCurrentTraceId(),eventType:"user.action.start",element:this.getElementPath(t)})):(s.getCurrentTraceId()||s.startNewTrace(),this.logGeneralClick(t))},!0)}static logGeneralClick(e){i.info("User clicked (general)",{traceId:s.getCurrentTraceId(),eventType:"ui.click",element:this.getElementPath(e)})}static startNewTraceForNavigation(e){let r=s.startNewTrace();i.info(`Navigation to ${e}`,{traceId:r,eventType:"navigation",url:e})}static getElementPath(e){let r=[],t=e;for(;t&&t.tagName;){let o=t.tagName.toLowerCase();if(t.id){o+=`#${t.id}`,r.unshift(o);break}else t.classList&&t.classList.length>0&&(o+=`.${Array.from(t.classList).join(".")}`);r.unshift(o),t=t.parentElement}return r.join(" > ")}};var b={init:c=>{s.startNewTrace(),i.init(c),m.init(),w.init(),v.init(),i.info("Cholog SDK Initialized",{traceId:s.getCurrentTraceId()})},log:i.info.bind(i),info:i.info.bind(i),warn:i.warn.bind(i),error:i.error.bind(i),debug:i.debug.bind(i),trace:i.trace.bind(i)},R=b;return E(k);})();
